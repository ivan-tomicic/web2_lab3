<!DOCTYPE html>
<html lang="en">
<head>
    <title>Web2 lab3</title>




</head>
<body onload="initializeCanvas()">

<canvas id="myCanvas" style="border:4px solid rgba(0,3,10,0.46); color:">
    Your browser does not support the HTML5 canvas tag.
</canvas>






<script>
    class Square {
        constructor(color, size, speed_x, speed_y, pos_x, pos_y) {
            this.color = color
            this.size = size;
            this.speed_x = speed_x
            this.speed_y = speed_y
            this.pos_x = pos_x
            this.pos_y = pos_y
        }
    }
    const colors = ["blue", "cyan", "green", "lightgreen", "blueviolet", "red", "pink", "firebrick", "magenta", "maroon", "sienna", "indigo", "olive", "turquoise", "orange", "dodgerblue", "darkgreen"]
    const squares = []

    function initializeCanvas() {
        var canvas = document.getElementById("myCanvas");
        var ctx = canvas.getContext("2d");

        canvas.width = 800;
        canvas.height = 800;

        square_size = 66

        components_total = Math.floor(Math.random() * 6) + 8;

        fillText(ctx, canvas, components_total)
        startGame(ctx, canvas, components_total, square_size)

    }

    function fillText(ctx, canvas, components_total) {
        ctx.shadowBlur = 0;
        ctx.fillStyle = "black";
        ctx.font = "20px Georgia";

        let txt = "Clicked components: 0"
        ctx.fillText(txt, canvas.width - 10 - ctx.measureText(txt).width, 30);

        txt = "Total components: " + components_total
        ctx.fillText(txt, canvas.width - 10 - ctx.measureText(txt).width, 60);
    }


    function startGame(ctx, canvas, components_total, square_size) {
        for(let i = 0; i < components_total; i++) {
            var square = new Square(colors[Math.floor(Math.random()*colors.length)], square_size,10,10, Math.floor(Math.random()*(canvas.width - square_size + 1)), Math.floor(Math.random()*(canvas.height - square_size + 1)))
            squares.push(square)
        }
        this.interval = setInterval(update, 20, ctx, canvas);
    }

    function update(ctx, canvas) {
        updateSquares(ctx, canvas)
        drawSquares(ctx)
    }

    function updateSquares(ctx, canvas) {
        for(let i = 0; i < squares.length; i++) {
            const square = squares[i]

            if (square.pos_x - square.size / 2 < 0)
                square.speed_x = 2;
            else if ((square.pos_x + square.size / 2) >= canvas.width)
                square.speed_x = -2;
            if (square.pos_y - square.size / 2 < 0)
                square.speed_y = -2;
            else if ((square.pos_y + square.size / 2) >= canvas.height)
                square.speed_y = 2;
            square.pos_x += square.speed_x;
            square.pos_y -= square.speed_y;
        }

    }

    function drawSquares(ctx) {
        ctx.save()

        ctx.clearRect(0, 0, 800, 800);


        for(let i = 0; i < squares.length; i++) {
            let square = squares[i]
            ctx.beginPath();
            ctx.fillStyle = square.color
            ctx.fillRect(square.pos_x, square.pos_y, square.size, square.size);
            ctx.stroke();
        }
        ctx.restore()
    }
</script>
</body>
</html>
